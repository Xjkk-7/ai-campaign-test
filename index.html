<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Campaign Test Site - GitHub Pages</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            text-align: center;
        }
        
        .header h1 {
            color: #333;
            margin: 0 0 10px 0;
            font-size: 2.5em;
        }
        
        .header p {
            color: #666;
            font-size: 1.2em;
            margin: 0;
        }
        
        .content-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h3 {
            color: #333;
            margin-top: 0;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
        }
        
        .feature-list {
            list-style: none;
            padding: 0;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            position: relative;
            padding-left: 25px;
        }
        
        .feature-list li:before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #27ae60;
            font-weight: bold;
        }
        
        .test-info {
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #27ae60;
            margin-right: 10px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .widget-status {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .btn {
            background: #667eea;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: background 0.3s ease;
            margin: 5px;
        }
        
        .btn:hover {
            background: #5a6fd8;
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-secondary:hover {
            background: #5a6268;
        }
        
        .footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
            padding: 20px;
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            .content-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ AI Campaign Test Site</h1>
            <p>Testing DashAssist AI Campaign Generation on GitHub Pages</p>
        </div>
        
        <div class="test-info">
            <h3><span class="status-indicator"></span>Campaign Testing Status</h3>
            <div class="widget-status">
                <strong>Widget Status:</strong> <span id="widget-status">Loading...</span><br>
                <strong>Page URL:</strong> <span id="current-url"></span><br>
                <strong>Load Time:</strong> <span id="load-time"></span>
            </div>
            
            <h4>How to Test AI Campaigns:</h4>
            <ol>
                <li>Create a campaign in your DashAssist admin panel</li>
                <li>Set the trigger URL to: <code>https://xjkk-7.github.io/ai-campaign-test/</code></li>
                <li>Enable AI content generation for the campaign</li>
                <li>Reload this page to see the campaign in action</li>
                <li>Look for the chat widget in the bottom-right corner</li>
            </ol>
            
            <div style="text-align: center; margin: 20px 0;">
                <button class="btn" onclick="checkWidgetStatus()">üîç Check Widget Status</button>
                <button class="btn btn-secondary" onclick="reloadPage()">üîÑ Reload Page</button>
            </div>
        </div>
        
        <div class="content-grid">
            <div class="card">
                <h3>üéØ Campaign Features</h3>
                <ul class="feature-list">
                    <li>URL-based campaign triggers</li>
                    <li>AI-generated content</li>
                    <li>Real-time message delivery</li>
                    <li>Context-aware responses</li>
                    <li>Proactive messaging</li>
                </ul>
            </div>
            
            <div class="card">
                <h3>üîß Technical Details</h3>
                <ul class="feature-list">
                    <li>GitHub Pages deployment</li>
                    <li>Chatwoot widget integration</li>
                    <li>DashAssist AI backend</li>
                    <li>WebSocket connections</li>
                    <li>Background job processing</li>
                </ul>
            </div>
            
            <div class="card">
                <h3>üìä Test Scenarios</h3>
                <ul class="feature-list">
                    <li>First-time visitor campaigns</li>
                    <li>Return visitor campaigns</li>
                    <li>Page-specific campaigns</li>
                    <li>Time-based campaigns</li>
                    <li>AI context analysis</li>
                </ul>
            </div>
        </div>
        
        <div class="debug-info">
            <h4>üîç Debug Information</h4>
            <div id="debug-log">
                Initializing test environment...
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>This is a test site for DashAssist AI Campaign functionality | Deployed on GitHub Pages</p>
    </div>

    <!-- DashAssist/Chatwoot Widget Script -->
    <script>
        // Initialize debug logging
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const debugLog = document.getElementById('debug-log');
            debugLog.innerHTML += `[${timestamp}] ${message}<br>`;
            debugLog.scrollTop = debugLog.scrollHeight;
            console.log(`[${timestamp}] ${message}`);
        }
        
        // Update status displays
        function updateStatus(status, message) {
            document.getElementById('widget-status').textContent = message;
            document.getElementById('widget-status').style.color = status === 'success' ? '#27ae60' : status === 'error' ? '#e74c3c' : '#f39c12';
        }
        
        // Display current page info
        document.getElementById('current-url').textContent = window.location.href;
        document.getElementById('load-time').textContent = new Date().toLocaleString();
        
        log('üöÄ Starting DashAssist widget initialization...');
        log(`üìç Current URL: ${window.location.href}`);
        log(`üåê User Agent: ${navigator.userAgent}`);
        
        // Initialize Chatwoot widget
        (function(d,t) {
            var BASE_URL = "http://129.212.164.115:3000";
            log(`üéØ Using base URL: ${BASE_URL}`);
            
            var g = d.createElement(t), s = d.getElementsByTagName(t)[0];
            g.src = BASE_URL + "/packs/js/sdk.js";
            g.defer = true;
            g.async = true;
            
            g.onload = function() {
                log('‚úÖ SDK script loaded successfully');
                
                if (typeof window.chatwootSDK !== 'undefined') {
                    log('‚úÖ chatwootSDK found, initializing widget...');
                    
                    try {
                        window.chatwootSDK.run({
                            websiteToken: 'KaYVhBikN2MdVyZJ2Wy6drea',
                            baseUrl: BASE_URL
                        });
                        
                        log('üéØ Widget initialized successfully');
                        updateStatus('success', 'Widget loaded and ready!');
                        
                        // Set up event listeners
                        window.addEventListener('chatwoot:ready', function() {
                            log('‚úÖ Chatwoot ready event fired');
                            updateStatus('success', 'Widget ready! Monitoring campaigns...');
                        });
                        
                        window.addEventListener('chatwoot:widget-opened', function() {
                            log('üîì Widget opened by user');
                        });
                        
                        window.addEventListener('chatwoot:widget-closed', function() {
                            log('üîí Widget closed - campaigns should trigger now');
                        });
                        
                        window.addEventListener('chatwoot:on-message', function(e) {
                            log(`üì® Message received: ${e.detail.message}`);
                        });
                        
                        window.addEventListener('chatwoot:error', function(e) {
                            log(`‚ùå Chatwoot error: ${e.detail}`);
                            updateStatus('error', 'Widget error occurred');
                        });
                        
                    } catch (error) {
                        log(`‚ùå Widget initialization failed: ${error.message}`);
                        updateStatus('error', 'Widget initialization failed');
                    }
                } else {
                    log('‚ùå chatwootSDK not found after script load');
                    updateStatus('error', 'Widget SDK not found');
                }
            };
            
            g.onerror = function() {
                log(`‚ùå Failed to load SDK from: ${g.src}`);
                updateStatus('error', 'Failed to load widget script');
            };
            
            s.parentNode.insertBefore(g, s);
            log('üì° Widget script tag inserted');
            
        })(document, "script");
        
        // Manual status check function
        function checkWidgetStatus() {
            log('üîç Manual status check...');
            log(`window.chatwootSDK: ${typeof window.chatwootSDK}`);
            log(`Document ready state: ${document.readyState}`);
            
            if (window.chatwootSDK) {
                log('‚úÖ chatwootSDK is available');
                updateStatus('success', 'Widget SDK loaded successfully');
            } else {
                log('‚ùå chatwootSDK is undefined');
                updateStatus('error', 'Widget SDK failed to load');
            }
        }
        
        // Reload page function
        function reloadPage() {
            log('üîÑ Reloading page...');
            location.reload();
        }
        
        // Initial status update
        setTimeout(() => {
            if (document.getElementById('widget-status').textContent === 'Loading...') {
                updateStatus('error', 'Widget failed to load within timeout');
                log('‚è∞ Widget load timeout');
            }
        }, 10000);
        
        log('üß™ Test website initialization complete');
    </script>
</body>
</html>
